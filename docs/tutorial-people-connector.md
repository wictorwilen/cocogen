# People connector tutorial (TypeSpec → .NET + JSON)

This tutorial walks through a **people** connector with skills plus a custom property. You’ll iterate the TypeSpec, generate a .NET project with JSON input, customize mapping for `@coco.noSource`, then provision and ingest.

## 0) What you need
- **Node.js 22+**
- **.NET SDK 10**
- A Microsoft Entra app registration with Microsoft Graph permissions (see the generated project README)

---

## 1) Start from scratch (recommended `init`)
```bash
npx @wictorwilen/cocogen@latest init --out ./schema.tsp --kind people
npm install
```

This scaffolds `schema.tsp`, `tspconfig.yaml`, and installs TypeSpec tooling for IntelliSense.

### Validate early
People connectors use **preview features**, so always validate with:

```bash
npx @wictorwilen/cocogen@latest validate --tsp ./schema.tsp --use-preview-features
```

---

## 2) Minimal people connector
Create or replace `schema.tsp` with:

```tsp
using coco;

@coco.connection({
  contentCategory: "people",
  name: "People skills connector",
  connectionId: "peopleskills",
  connectionDescription: "People connector generated by cocogen"
})
@coco.profileSource({
  webUrl: "https://example.com/people",
  displayName: "People source"
})
@coco.item
model PersonProfile {
  @coco.id
  @coco.label("personAccount")
  @coco.source("userPrincipalName")
  userPrincipalName: string;

  @coco.label("personName")
  @coco.source("displayName")
  displayName: string;
}
```

Validate:

```bash
npx @wictorwilen/cocogen@latest validate --tsp ./schema.tsp --use-preview-features
```

---

## 3) Add skills + a custom property
Skills use the people label `personSkills`. Add a custom property with `@coco.noSource` for computed data.

```tsp
using coco;

@coco.connection({
  contentCategory: "people",
  name: "People skills connector",
  connectionId: "peopleskills",
  connectionDescription: "People connector generated by cocogen"
})
@coco.profileSource({
  webUrl: "https://example.com/people",
  displayName: "People source"
})
@coco.item
model PersonProfile {
  @coco.id
  @coco.label("personAccount")
  @coco.source("userPrincipalName")
  userPrincipalName: string;

  @coco.label("personName")
  @coco.source("displayName")
  displayName: string;

  @coco.label("personSkills")
  @coco.source("skills[*].name")
  skills: string[];

  @coco.noSource
  orgUnitCode: string;
}
```

Reference docs:
- [Register and manage schema (semantic labels)](https://learn.microsoft.com/en-us/graph/connecting-external-content-manage-schema#schema-attributes)
- [People connectors overview](https://learn.microsoft.com/en-us/microsoft-365-copilot/extensibility/overview-copilot-connector)

Validate again:

```bash
npx @wictorwilen/cocogen@latest validate --tsp ./schema.tsp --use-preview-features
```

---

## 4) Generate a .NET + JSON project
```bash
npx @wictorwilen/cocogen@latest generate \
  --tsp ./schema.tsp \
  --lang dotnet \
  --data-format json \
  --out ./people-skills-connector \
  --use-preview-features
```

### Input formats
- **csv** (default)
- **json** (JSONPath)
- **yaml** (JSONPath)
- **rest** (JSONPath)
- **custom** (stub datasource)

---

## 5) Quick tour of the scaffold
In `people-skills-connector/`:
- `Program.cs` — CLI: provision, ingest, delete
- `Datasource/JsonItemSource.cs` — JSON reader
- `PropertyTransformBase.cs` — generated mapping
- `PropertyTransform.cs` — **your customization hook**
- `appsettings.json` — config defaults

---

## 6) Add custom logic for `@coco.noSource`
Edit `PropertyTransform.cs` (safe file):

```csharp
// Customize row-to-model property transforms.
namespace PeopleSkillsConnector;

public sealed class PropertyTransform : PropertyTransformBase
{
  protected override string TransformOrgUnitCode(object row)
    {
    return "EU-Platform";
    }
}
```

---

## 7) Provision the connection
```bash
dotnet run -- provision
```

---

## 8) Ingest data (JSON)
```bash
dotnet run -- ingest --input ./data.json
```

Helpful flags:
- `--dry-run`
- `--verbose`
- `--limit 10`

---

## 9) Next steps
- Update `schema.tsp` and re-run `cocogen update --out ./people-skills-connector`.
- Swap `JsonItemSource` for your own datasource.
