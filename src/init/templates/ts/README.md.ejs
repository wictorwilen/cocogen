Generated by cocogen.

## Quickstart
1) Copy `.env.example` to `.env` and fill in values.
2) `npm install`
3) `npm run provision`
<% if (inputFormat === "custom") { -%>
4) Implement your datasource in `src/datasource/customItemSource.ts`
5) `npm run ingest`
6) (Optional) `npm run delete`
<% } else { -%>
4) `npm run ingest`
5) (Optional) `npm run delete`
<% } -%>

<% if (isPeopleConnector) { -%>
Note: this is a People connector (preview). It uses Graph beta endpoints and registers the connection as a profile source during `provision`.
<% } -%>

## Graph API version note
If your schema sets `@coco.connection({ contentCategory: "..." })`, provisioning must use Microsoft Graph **/beta** because `externalConnection.contentCategory` is currently exposed on the beta endpoint.

## Requirements
- Microsoft Entra app registration with application permissions:
	- `ExternalConnection.ReadWrite.OwnedBy`
	- `ExternalItem.ReadWrite.OwnedBy`
<% if (isPeopleConnector) { -%>
	- `PeopleSettings.ReadWrite.All` (required for profile source registration)
<% } -%>

## Authentication
The generated CLI prefers managed identity. If you run on Azure with a managed identity, leave `TENANT_ID`, `CLIENT_ID`, and `CLIENT_SECRET` unset and (optionally) set `MANAGED_IDENTITY_CLIENT_ID` for user-assigned identities.

To use client secret auth locally, set `TENANT_ID`, `CLIENT_ID`, and `CLIENT_SECRET` in `.env` or environment variables.

## TypeSpec editor support
This project includes `tspconfig.yaml` and a devDependency on `@wictorwilen/cocogen` so VS Code can resolve `using coco;`.
Run `npm install` to fetch the TypeSpec library.

## Customizing the project
- **Schema and fields**: edit `schema.tsp` (copied into this folder) and run `cocogen update --out .` to regenerate `src/<%= schemaFolderName %>`.
- **Ingestion**: replace the datasource in `src/datasource` (generated for <%= inputFormat %>) and wire it in `src/cli.ts`.
<% if (inputFormat === "custom") { -%>
- **Custom input**: `CustomItemSource` throws by defaultâ€”replace it with your own backend implementation.
<% } -%>
- **Input format**: fixed to `<%= inputFormat %>` for this project. Re-run `cocogen generate` to switch formats.
- **Property transforms**: edit `src/<%= schemaFolderName %>/propertyTransform.ts` (kept on updates) to customize per-field parsing/mapping.
- **Connection defaults**: `@coco.connection` must set `name`, `connectionId`, and `connectionDescription` defaults for `.env.example`.
- **Profile source defaults**: `@coco.profileSource` sets defaults for `PROFILE_SOURCE_*` (people connectors only).
- **Access control**: edit `src/<%= schemaFolderName %>/itemPayload.ts` to change ACL behavior.

## Ingest debugging flags
Use `npm run ingest --` with:
- `--dry-run` (build payloads without sending)
- `--fail-fast` (abort on the first item failure)
- `--limit <n>` (ingest only N items)
- `--verbose` (print the exact payload sent to Graph)

Note: `--dry-run` does not require CONNECTION_ID, but you still need it for real ingestion.

## Switching from the generated datasource
1) Implement `ItemSource<<%= itemTypeName %>>` in `src/datasource`.
2) If your source yields raw records, map them to `<%= itemTypeName %>` using `fromRow`-style logic.
3) Update `src/cli.ts` to instantiate your new source instead of the generated source.

Tip: keep the streaming `AsyncIterable<<%= itemTypeName %>>` pattern for large datasets.

## Multiple connections
This generated CLI currently targets a single connection ID from environment variables. Multi-connection support is planned for a future version.
