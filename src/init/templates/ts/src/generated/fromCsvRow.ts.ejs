import type { Item } from "./model.js";
import {
  parseBoolean,
  parseNumber,
  parseNumberCollection,
  parseString,
  parseStringCollection,
  readSourceValue
} from "../datasource/csv.js";
<% if (propertyTransforms.length > 0) { -%>
import {
<% for (const prop of propertyTransforms) { -%>
  transform<%= prop.transformName %>,
<% } -%>
} from "./propertyTransforms.js";
<% } -%>
<% if (hasPersonEntities) { -%>
import { buildPersonEntityDefault, buildPersonEntityDefaultCollection } from "./personEntityDefaults.js";
import { transformPersonEntity, transformPersonEntityCollection } from "./personEntityOverrides.js";
<% } -%>

export function fromCsvRow(row: Record<string, unknown>): Item {
  return {
<% for (const prop of properties) { -%>
  <% if (prop.expression) { -%>
    <%= prop.name %>: <%= prop.isCollection ? "transformPersonEntityCollection" : "transformPersonEntity" %>(
      <%= JSON.stringify(prop.name) %>,
      row,
      <%= prop.isCollection ? "buildPersonEntityDefaultCollection" : "buildPersonEntityDefault" %>(
        <%= JSON.stringify(prop.name) %>,
        row
      )
    ),
  <% } else { -%>
    <% if (prop.isExplicitSource) { -%>
    <%= prop.name %>: transform<%= prop.transformName %>(readSourceValue(row, <%= JSON.stringify(prop.csvHeaders) %>)),
    <% } else { -%>
    <%= prop.name %>: transform<%= prop.transformName %>(row),
    <% } -%>
  <% } -%>
<% } -%>
  };
}
