/**
 * Generated property transforms derived from TypeSpec.
 * Regenerated on every cocogen update.
 */

import {
  parseBoolean,
  parseNumber,
  parseNumberCollection,
  parseString,
  parseStringCollection,
  readSourceValue,
  applyDefaultString,
  applyDefaultCollection,
} from "../datasource/row.js";
import {
  validateNumber,
  validateNumberCollection,
  validateString,
  validateStringCollection,
} from "../core/validation.js";
<% if (peopleEntityTypes && peopleEntityTypes.length > 0) { -%>
import type {
<% for (const typeName of peopleEntityTypes) { -%>
  <%= typeName %>,
<% } -%>
} from "../core/people.js";
<% } -%>
<% if (usesPrincipal) { -%>
import type { Principal } from "../core/principal.js";
<% } -%>

/**
 * Base class for row-to-model transforms.
 */
export abstract class PropertyTransformBase {
  /**
   * Transform a property by name using the generated transform methods.
   */
  public transformProperty<T>(name: string, row: Record<string, unknown>): T {
    switch (name) {
<% for (const prop of properties) { -%>
      case <%= JSON.stringify(prop.name) %>:
        return this.transform<%= prop.transformName %>(row) as T;
<% } -%>
      default:
        throw new Error(`Unknown property '${name}'.`);
    }
  }

<% for (const prop of properties) { -%>
  /** Transform the <%= prop.name %> property from a source row. */
  protected transform<%= prop.transformName %>(row: Record<string, unknown>): <%= prop.tsType %> {
    return <%- prop.expression
      .split("\n")
      .map((line, index) => {
        if (index === 0) return line;
        const trimmed = line.trimStart();
        const isClosing =
          trimmed.startsWith(")") ||
          trimmed.startsWith("]") ||
          (trimmed.startsWith("}") && !trimmed.includes(" as "));
        return `${isClosing ? "    " : "      "}${line}`;
      })
      .join("\n") %>;
  }

<% } -%>
}
