// Generated property transforms derived from TypeSpec.
using System;
using System.Collections.Generic;
<% if (usesPersonEntity) { -%>
using System.Linq;
using System.Text.Json;
<% } -%>
using <%= namespaceName %>.Datasource;

namespace <%= namespaceName %>.Schema;

/// <summary>
/// Base class for CSV-to-model property transforms.
/// </summary>
public abstract class PropertyTransformBase
{
    /// <summary>
    /// Transform a property by name using the generated transform methods.
    /// </summary>
    public object TransformProperty(string name, IReadOnlyDictionary<string, string?> row)
    {
        return name switch
        {
<% for (const prop of properties) { -%>
            <%= JSON.stringify(prop.name) %> => Transform<%= prop.csName %>(row),
<% } -%>
            _ => throw new ArgumentOutOfRangeException(nameof(name), $"Unknown property '{name}'."),
        };
    }

<% for (const prop of properties) { -%>
    /// <summary>
    /// Transform the <%= prop.name %> property from a CSV row.
    /// </summary>
    protected virtual <%= prop.csType %> Transform<%= prop.csName %>(IReadOnlyDictionary<string, string?> row)
    {
    <% if (prop.transformThrows) { -%>
        <%- prop.transformExpression %>;
    <% } else { -%>
        return <%- prop.transformExpression %>;
    <% } -%>
    }

<% } -%>
}
